\section{Evaluation}
% To develop a preliminary understanding of the energy contributions of the model reconfiguration from external memory, we evaluate a variety of realistic and applicable models.
% The power is the configuration of a model and a single inference with the model at \SI{60}{FPS}.
% Effectively, this means that the same model is configured on the \graicore{} 60 times per second and also used to proces an input frame 30 times per second.

To develop a preliminary understanding of the energy contributions of the model reconfiguration from external memory, we evaluate a variety of realistic models.
We will be looking at two different external memory technologies, LPDDR5X and PCM.
LPDDR5X is chosen for its high bandwidth and density, while PCM is selected for its potential to reduce energy consumption due to its non-volatility.
Non-volatility in PCM reduces energy consumption by retaining data without the need for constant power, unlike volatile memory (e.g., LPDDR5X), which requires continuous refreshing.
We use the DDR interface described in \cref{section:configuration_energy} for transferring data to the AXI bus that is connected to the \graicore{}.
% For the DDR protocol to work, we require an DDR PHY and DDR controller.
% These components both add to the energy when transferring data to the \graicore{}.

% \begin{table}[hbtp]
%     \centering
%     \begin{threeparttable}
%         \begin{tabular}{@{}lrl@{}}
%         \toprule
%         \textbf{Component} & \textbf{Value} & \textbf{Unit} \\
%         \midrule
%         LPDDR5X read\tnote{1}               & 36.00 & pJ/B \\
%         PCM read\tnote{2}                   & 5.29  & pJ/B \\
%         DDR PHY\tnote{3}                    & 10.39 & pJ/B \\
%         DDR Controller\tnote{3}             & 1.56  & pJ/B \\
%         AXI Bus\tnote{3}                    & 6.25  & pJ/B \\
%         \confignoc{} hop (64 bits)\tnote{3} & 0.26  & pJ   \\
%         SRAM write (64 bits)\tnote{3}       & 4.98  & pJ   \\ \bottomrule
%         \end{tabular}
%         \begin{tablenotes}
%             \item[1] From internal research of the MT62F1G16D1 memory chip from Micron.
%             \item[2] From internal research of a custom PCM memory architecture.
%             \item[3] From internal measurements.
%             % \item[3] From internal measurements (\SI{133}{mW} at full capacity).
%             % \item[4] From internal measurements (\SI{20}{mW} at full capacity).
%             % \item[5] From internal measurements (\SI{80}{mW} at full capacity).
%         \end{tablenotes}
%     \end{threeparttable}
%     \caption{Energy parameters of PCM and LPDDR5X memory, DDR interface and \graicore{} that are relevant for model configuration}
%     \label{tab:energy_parameters}
% \end{table}

The energy parameters for each of the components are derived through a combination of low-level simulations, hardware measurements, and datasheet analysis.
Low-level simulations and on-chip measurements provides granular energy consumption data for the DDR PHY, DDR controller, \confignoc{} and SRAM.
For the LPDDR5X memory, where such detailed analysis was not possible, the energy parameter for reading from the memory was extracted from a datasheet of a commercially available memory module.
The read energy of PCM was obtained through analysis of a custom-designed PCM architecture.
It is important to note that the analyses, measurements and simulations were sourced from research conducted by others.
These parameters enable us to estimate configuration energy consumption, including data reads from external memory, transfers of the data to the SRAMs, and the writing of the data the the SRAMs.

We look at the models as shown in \cref{tab:example_models_stats}.
It also shows the processing latency, the number of cores used and the average utilization of the cores of each (mapped) model.
These statistics are used for computing the processing energy.
The ``to write'' column shows the total number of bytes that is to be transferred to the \graicore{} for the corresponding model.
Note that to get a more accurate energy number for configuration, we need the number of bytes to be transferred to each core individually.
This information is obtained from the compiler artifacts, and will be used for the evaluation.

\begin{table}[hbtp]
\centering
\begin{tabular}{@{}lrrrrr@{}}
\toprule
\textbf{Model}          & \textbf{\begin{tabular}[c]{@{}l@{}}Latency\\ (ms)\end{tabular}} & \textbf{\begin{tabular}[c]{@{}l@{}}Cores\\used\end{tabular}} & \textbf{Avg util.} & \textbf{\begin{tabular}[c]{@{}l@{}}To write\\ (MiB)\end{tabular}} \\ \midrule
efficientnet            & 1.642                                                           & 144            & 50.89\%            & 16.15                                                             \\
mobnetv2                & 1.296                                                           & 144            & 40.78\%            & 10.67                                                             \\
object\_tracker         & 1.480                                                           & 144            & 36.62\%            & 12.33                                                             \\
object\_detector        & 4.809                                                           & 144            & 68.03\%            & 19.12                                                             \\
resnet50                & 5.765                                                           & 144            & 36.35\%            & 29.58                                                             \\
resnet101\_p0           & 7.080                                                           & 144            & 33.40\%            & 28.75                                                             \\
resnet101\_p1           & 2.647                                                           & 143            & 36.42\%            & 20.06                                                             \\
resnet101\_p2           & 4.011                                                           & 144            & 33.12\%            & 30.44                                                             \\
resnet101\_p3           & 2.343                                                           & 143            & 33.55\%            & 17.71                                                             \\
resnet101\_p4           & 2.040                                                           & 143            & 26.19\%            & 15.54                                                             \\
resnet101\_pruned\_p0   & 6.552                                                           & 144            & 38.10\%            & 15.87                                                             \\
resnet101\_pruned\_p1   & 3.245                                                           & 143            & 34.31\%            & 10.43                                                             \\
resnet101\_pruned\_p2   & 4.501                                                           & 143            & 33.83\%            & 16.00                                                             \\
resnet101\_pruned\_p3   & 2.114                                                           & 143            & 38.08\%            & 10.22                                                             \\
resnet101\_pruned\_p4   & 2.437                                                           & 143            & 24.25\%            & 7.69                                                              \\
\bottomrule
\end{tabular}
\caption{
    Statistics of various mapped models.
    The latency, cores used and average utilization are obtained from simulations with the performance simulator.
    The number of bytes to write are obtained from the compiler artifacts.
}
\label{tab:example_models_stats}
\end{table}

% As an example, we demonstrate a calculation for the ResNet-50 model.
% The processing energy is calculated as follows (assuming an average core power of \SI{21}{mW}\footnote{This constant is obtained from internal RTL simulations.}):
% \begin{equation}
%     \eproc = 0.3635 \times 144 \times \SI{5.765}{ms} \times \SI{21}{mW} = \SI{6.34}{mJ}
% \end{equation}

\Cref{fig:model_data_heapmap} shows for the mapped ResNet-50 the amount of data to be sent to each individual core.
We use this information to construct matrix $D$ and compute the configuration energy $\econf$.
Finally, we obtain the values as presented in \cref{fig:resnet50_conf_energy_distribution}.
The configuration of the ResNet-50 model on the \graicore{} was calculated to consume \SI{1.71}{mJ} with LPDDR5X and \SI{0.76}{mJ} with PCM.
% Finally, we compute the values as presented in \cref{tab:resnet50_energy}.

% \begin{table}[hbtp]
%     \centering
%     \begin{tabular}{@{}lr@{}}
%     \toprule
%     \textbf{Component} & \textbf{Value} \\
%     \midrule
%     $\ereadlpddr5x$ & 1116.8 \\
%     $\ereadpcm$ & 164.2 \\
%     $\ephy$ & 322.4 \\
%     $\ectrl$ & 48.5 \\
%     $\eaxi$ & 193.9 \\
%     $\enoc$ & 9.2 \\
%     $\ewrite$ & 19.3 \\
%     \bottomrule
%     \end{tabular}
%     \caption{
%         Computed energy values for each relevant component during configuration.
%         All values shown are in \SI{}{\micro\joule}.
%     }
%     \label{tab:resnet50_energy}
% \end{table}

% Then, the total energy consumption when performing a single configuration and a single inference is \SI{8.05}{mJ} for LPDDR5X and \SI{7.09}{mJ} for PCM.

\begin{figure}[hbtp]
    \centering
    \subcaptionbox{LPDDR5X\label{fig:pie_resnet50_conf_lpddr5x}}{
        \input{assets/power_analysis/baseline/lpddr5x/pie_resnet50_conf.tex}
    }
    \hfill
    \subcaptionbox{PCM\label{fig:pie_resnet50_conf_pcm}}{
        \input{assets/power_analysis/baseline/pcm/pie_resnet50_conf.tex}
    }
    \caption{ResNet-50 configuration energy distribution. The ``other'' slice includes $\ectrl$, $\enoc$ and $\ewrite$.}
    \label{fig:resnet50_conf_energy_distribution}
\end{figure}

% Looking at the configuration energy, with LPDDR5X, most of the energy is consumed by reading from the external memory (see \cref{fig:resnet50_conf_energy_distribution}).
% Looking at the total configuration energy, with the LPDDR5X memory, most of the energy is consumed by reading from the external memory ($\eread$).
% Looking at the total configuration energy, with the LPDDR5X memory, the majority (65\%) of the energy is consumed by reading from the external memory ($\eread$).
% While for PCM, most of the energy (43\%) is consumed by the DDR PHY ($\ephy$).

% Looking at the total configuration energy, with the LPDDR5X memory, read operations are the primary energy consumer, accounting for 65\% of the total configuration energy.
% This highlights the importance of optimizing read efficiency in LPDDR5X-based systems.
% For the PCM, the DDR PHY is the most energy-intensive component, consuming around 43\% of the total configuration energy.

We observe that with LPDDR5X memory, read operations dominate the energy consumption (65\%), whereas in PCM, the DDR PHY is the most energy-intensive (43\%).
Notably, PCM exhibits a much higher proportion of energy dedicated to the DDR PHY compared to LPDDR5X.
The AXI bus also represents a significant energy consumer in both cases, with its energy consumption being comparatively higher in PCM (25\% vs 11\%).
Based on the relative energy distribution shown, potential avenues for improving energy efficiency may include optimizing read operations in LPDDR5X and the DDR PHY in PCM.
However, further investigation with absolute energy measurements is needed to confirm the effectiveness of these strategies.

\begin{figure}[hbtp]
    \centering
    \subcaptionbox{LPDDR5X\label{fig:pie_resnet50_conf_proc_lpddr5x}}{
        \input{assets/power_analysis/baseline/lpddr5x/pie_resnet50_conf_proc.tex}
    }
    \hfill
    \subcaptionbox{PCM\label{fig:pie_resnet50_conf_proc_pcm}}{
        \input{assets/power_analysis/baseline/pcm/pie_resnet50_conf_proc.tex}
    }
    \caption{Configuration vs. processing energy for the ResNet-50 model}
    \label{fig:resnet50_conf_proc}
\end{figure}

When examining both configuration and processing energy, \cref{fig:resnet50_conf_proc} offers insight into the total energy consumption profile of the ResNet-50 model.
LPDDR5X allocates 21\% of its total energy budget to configuration, a significant portion that indicates considerable energy consumption in model setup.
In contrast, PCM dedicates only 11\% to configuration, with the difference primarily attributed to the more efficient read operations from PCM memory.
% This disparity underscores a potential advantage of PCM in scenarios with large amounts of data to be transferred, where minimizing configuration energy becomes crucial.

% Of all the models listed in \cref{tab:example_models_stats}, on average, around 23\% is used for configuration with LPDDR5X memory and 12\% with PCM as external memory (see \cref{fig:example_models_avg_conf_proc}).

\cref{fig:example_models_avg_conf_proc} broadens our perspective by showing the average energy consumption distribution across a variety of models listed in \cref{tab:example_models_stats}.
This provides a more generalized view of the energy characteristics of LPDDR5X and PCM.
Interestingly, the trend observed in the ResNet-50 model persists: PCM dedicates a smaller proportion of energy to configuration (12\%) compared to LPDDR5X (23\%).
This reinforces the idea that PCM might offer energy efficiency advantages in scenarios where minimizing configuration energy is a priority

\begin{figure}[hbtp]
    \centering
    \subcaptionbox{LPDDR5X\label{fig:sunburst_avg_conf_proc_lpddr5x}}{
        \input{assets/power_analysis/baseline/lpddr5x/sunburst_avg_conf_proc.tex}
    }
    \hfill
    \subcaptionbox*{}[0em]{
        \includegraphics{assets/legend.pdf}
    }
    \hfill
    \subcaptionbox{PCM\label{fig:sunburst_avg_conf_proc_pcm}}{
        \input{assets/power_analysis/baseline/pcm/sunburst_avg_conf_proc.tex}
    }
    \caption{Average energy consumption distribution of the models listed in \cref{tab:example_models_stats}}
    \label{fig:example_models_avg_conf_proc}
\end{figure}

% When performing configuration and processing at \SI{60}{FPS}, we get the power values as shown in \cref{tab:example_models_power_consumption}.
Ideally, the energy consumption of the configuration of a model should be as small as possible.
In \cref{ch:7}, we explore techniques for increasing configuration efficiency.

% \begin{table}[hbtp]
%     \centering
%     \begin{threeparttable}
%         \begin{tabular}{@{}lrrr@{}}
%             \toprule
%                                        & \multicolumn{2}{l}{\textbf{Conf. power (mW)}} & \textbf{Proc. power (mW)} \\ \cmidrule(l){2-3} 
%             \textbf{Model}             & \textit{LPDDR5X}  & \textit{PCM}    & \\ \midrule
%             efficientnet               & 56.0              & 24.8            & 151.6 \\
%             mobnetv2                   & 37.0              & 16.4            & 95.9 \\
%             object\_tracker              & 42.8              & 18.9            & 98.3 \\
%             object\_detector             & 66.3              & 29.4            & 593.6 \\
%             resnet50                   & 102.6             & 45.4            & 380.2 \\
%             resnet101\tnote{1}         & 390.2             & 172.8           & 1081.7 \\
%             resnet101\_pruned\tnote{1} & 208.9             & 92.5            & 1179.4 \\ \bottomrule
%         \end{tabular}
%         \begin{tablenotes}
%             \item[1] Combination of all parts
%         \end{tablenotes}
%     \end{threeparttable}
%     \caption{Power consumption of configuration (of the same model) and processing of an input frame at \SI{60}{Hz}}
%     \label{tab:example_models_power_consumption}
% \end{table}
    
These findings provide valuable insights into the dynamic energy consumption of LPDDR5X and PCM across different models, highlighting the potential of PCM for reduced configuration energy.
However, it is important to emphasize that this analysis focused solely on dynamic energy, which is the energy consumed during active operation.
To gain a complete understanding of the energy efficiency of these technologies, further investigation into static energy consumption is necessary.
% Static energy refers to the energy consumed even when the system is idle, and it can contribute significantly to the overall energy budget.
% By considering both dynamic and static energy, a more comprehensive and accurate comparison of LPDDR5X and PCM can be achieved, guiding the development of an energy-efficient memory solutions.